/* 
 * File:   lookup.cpp
 * Author: Gustav Ã–st
 *
 * Created on October 30, 2014
 */
 
#include "lookup.h"

const unsigned int Lookup::etable[256] PROGMEM = {
     0, 1, 1, 2, 2, 3, 3, 3, 4, 4, 5, 5, 6, 7, 7, 8,
     8, 9, 9,10,11,11,12,13,13,14,15,15,16,17,18,18,
    19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,
    34,36,37,38,39,40,42,43,44,46,47,48,50,51,53,54,
    56,57,59,61,62,64,66,68,69,71,73,75,77,79,81,83,
    86,88,90,92,95,97,100,102,105,107,110,113,116,118,121,124,
   127,130,134,137,140,144,147,151,154,158,162,165,169,173,177,182,
   186,190,195,199,204,208,213,218,223,228,234,239,244,250,256,262,
   268,274,280,286,293,299,306,313,320,327,334,342,350,357,365,374,
   382,390,399,408,417,426,436,445,455,465,475,486,497,508,519,530,
   542,554,566,578,591,604,617,631,644,658,673,687,702,718,733,749,
   766, 782, 799, 816, 834, 852, 871, 890, 909, 929, 949, 969, 990,1012,1033,1056,
  1078,1102,1126,1150,1175,1200,1226,1252,1279,1307,1335,1363,1393,1423,1453,1484,
  1516,1549,1582,1616,1651,1686,1722,1759,1797,1835,1875,1915,1956,1998,2040,2084,
  2129,2174,2221,2268,2317,2366,2417,2468,2521,2575,2630,2686,2743,2802,2862,2923,
  2985,3049,3114,3180,3248,3317,3388,3460,3534,3609,3686,3765,3845,3927,4011,4095};
  
unsigned int Lookup::get(uint8_t i) {
 // Need to read the table in a special way!
 return (unsigned int) pgm_read_word(&etable[i]);
}

// If the compiler could build the above table for us, we could have "simply":
//return !i ? 0 : round(exp(log(MAXOUTPUT) * i / MAXINPUT));
/*
// Javascript generator: 5.5
	var start = 0;
	var end = 1;
	var a = [], a2 = [], a3 =[];
	var e0 = Math.exp(start);
	var e1 = Math.exp(end);
	var exp = function(i) { 
		return ((Math.exp(i) - e0) / (e1 - e0) ); 
	}
	var discreteCurve = function(end) {
		if( end === start ) return;
		aTemp = [];
		e1 = Math.exp(end);
		for(var i=start; i<=end; i+=(end - start)/256) {
			aTemp.push( {x: i*256/(end - start),
		    	         y: Math.round(exp(i) * 4096) } ); 
			};
		return aTemp;
	}
*/

